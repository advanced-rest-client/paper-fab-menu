<!--
@license
Copyright 2016 Pawel Psztyc, The ARC team

Licensed under the Apache License, Version 2.0 (the "License"); you may not
use this file except in compliance with the License. You may obtain a copy of
the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations under
the License.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<!--
The `<paper-fab-menu-item>` is a menu item that can be used with `<paper-fab-menu>`.
It renders as a mini fab button but it's hidden. The `<paper-fab-menu>` triggers menu items when hovered.

See `<paper-fab-menu>` for more information and demos.

-->
<dom-module id="paper-fab-menu-item">
  <template>
    <style>
    :host {
      display: block;
      @apply(--layout-flex);
      margin: 7px;
    }

    .menu-item {
      display: block;
      position: relative;
      transition: 300ms all cubic-bezier(0.165, 0.84, 0.44, 1);
      transform: scale(0);
    }

    .menu-item.opened {
      transform: scale(1);
    }
    </style>
    <div class$="[[_computeMainClass(opened)]]" id="menuItem">
      <paper-fab id="paperFab" mini icon="[[icon]]" label="[[label]]"></paper-fab>
      <paper-tooltip animation-delay="2" offset="4" margin-top="0" position="[[tooltipPosition]]">[[tooltip]]</paper-tooltip>
    </div>
  </template>
  <script>
  Polymer({
    is: 'paper-fab-menu-item',
    properties: {
      // Color of the menu item.
      color: String,
      // The position of rhe tooltop. See paper-tooltip for the api.
      tooltipPosition: {
        type: String,
        value: 'left'
      },
      // Tooltip display text
      tooltip: String,
      // The delay (in ms) before the entry / exit animation begins.
      transitionDelay: Number,
      // Label only used with paper-fab when the icon is not present.
      label: String,
      // The icon to render. It's binded to `paper-fab`'s icon property.
      icon: String,
      /**
       * If true this item will be rendered as opened.
       * This property is used by the `paper-fab-menu` element to determine
       * control state. Do not use this property.
       */
      opened: {
        type: Boolean,
        value: false
      }
    },

    observers: [
      '_updateTransitionDelay(transitionDelay)',
      '_colorChanged(color)',
      '_openedChanged(opened)'
    ],

    _updateTransitionDelay: function(transitionDelay) {
      this.$.menuItem.style.transitionDelay = transitionDelay + 'ms';
    },

    // Called when color has changed.
    _colorChanged: function(color) {
      this.customStyle['--paper-fab-background'] = color;
      this.updateStyles();
      // For some reason code above do not affect main fab at bootstrap.
      this.$.paperFab.style.backgroundColor = color;
    },

    _computeMainClass: function(opened) {
      var clazz = 'menu-item';
      if (opened) {
        clazz += ' opened';
      }
      return clazz;
    },

    _openedChanged: function(opened) {
      if (!opened) {
        return;
      }
      this.async(function() {
        this.$$('paper-tooltip').updatePosition();
      }, this.transitionDelay || 1);
    }
  });
  </script>
</dom-module>
